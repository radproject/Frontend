<div class='pageContainer' *ngIf='!(isLoading$|async)'>
  <div class='topRow'>
    <div class='private'>
        <mat-icon *ngIf='(topic$|async).isPrivate'>lock_open</mat-icon>
        <mat-icon *ngIf='!((topic$|async).isPrivate)'>public</mat-icon>
    </div>
    <h1>{{(topic$|async) != null?((topic$|async).Title):'Unknown'}}</h1>
    <small>Created: {{(topic$|async).CreationDate | date}}</small>
    <div class='sub' *ngIf='(user$|async)'>
      <button class='btn btn-primary' *ngIf='!isSubbed()' (click)='subToTopic()'>Subscribe</button>
      <button class='btn btn-danger' *ngIf='isSubbed()' (click)='unsubFromTopic()'>Unsubscribe</button>
    </div>
  </div>
  
  <div *ngIf='((topic$|async).posts)' class='postList'>
    <div *ngFor='let p of ((topic$|async).posts)' class='postItem'>
      <div class='info'>
        <div>
          <h4>{{p.Creator?p.Creator.Name:'Anon'}}</h4>
          <p>({{p.Creator?p.Creator.StudentId:''}})</p>
        </div>
        <small>Posted: {{p.TimeStamp*1000|date}}</small>
      </div>
      <div class='content'>
        <p>{{p.Text}}</p>
      </div>
      <div class='info'>
        <div>
          <mat-icon (click)='deletePost(p.ID)' class="delete">delete</mat-icon>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf='!((topic$|async).posts)' class='noPosts'>
    <div>
      <h2>No Posts</h2>
      <mat-icon>cancel_presentation</mat-icon>
    </div>
  </div>


  <form [formGroup]='postForm' *ngIf='(user$|async)'>
    <textarea id='message' class='form-control' formControlName='message'></textarea>
    <button class='btn btn-primary' (click)='openFileUpload()'><mat-icon>attachment</mat-icon></button>
    <button class='btn btn-primary' (click)='tryPost()' [disabled]='!postForm.valid'><mat-icon>send</mat-icon></button>
  </form>
</div>